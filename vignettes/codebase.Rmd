---
title: "portalcasting Codebase"
output: rmarkdown::html_vignette
author: "Juniper L. Simonis"
date: "`r format(Sys.time(), '%d %B, %Y')`"
vignette: >
  %\VignetteIndexEntry{codebase}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r, include=FALSE}
library(portalcasting)
vers <- packageVersion("portalcasting")
today <- Sys.Date()
```

This vignette outlines the codebase for the **portalcasting** package (v`r vers`), which underlies the automated iterative forecasting within the [Portal Predictions production pipeline](https://github.com/weecology/portalPredictions). **portalcasting** has utilities for setting up local versions of the pipeline for developing and testing new models. 

## Installation

To install the most recent version of **portalcasting** from GitHub:

```{r, eval=FALSE}
install.packages("devtools")
devtools::install_github("weecology/portalcasting")
```

## Directory Structure

The package uses a directory tree with three levels to organize the project:

* `base`: folder where the project folder will be housed
* `main`: project folder encompassing all subfolders
* `subs`: specific subfolders that organize the project files
 
In particular, the tree is

```
base
│   
└──main
│   │
│   └──predictions
│   │   <previous and current predictions>
│   └──models
│   │   <model scripts>
│   └──data
│   │   <data used for a specific run of models>
│   └──raw
│   │   <stable version of raw data used to populate the data folder>
│   └──tmp
│   │   <temporary files>
```

The tree is housed in a `list` with special class `dirtree` that is created by `dirtree()`. This allows for easy management and tracking of the directory structure, as well as renaming/relocating of the folders at all three levels, although it is only advisable to alter the `base` and `main` levels, as many functions require specifically-named `subs`. Functions in **portalcasting** can take either `tree` or `base`/`main`/`subs` argument inputs, and any level-specific inputs override the `tree` value.

## Instantiating a Directory

Setting up a fully functional directory for a production or sandbox pipeline consists of two steps: creating (instantiating folders that are missing) and filling (adding files to the folders).

### Creating 

The directory is established using `create_dir()`, which takes a `dirtree` `list` as its first argument (`tree`) or takes individual levels as they would be input into `dirtree()`, including `base`, `main`, and `subs` as arguments, which override any values in `tree`. `create_dir()` in sequence creates each of the levels' (`base`, `main`, `sub`) folders if they do not already exist. This occurs through calls to `create_base()`, `create_main()`, and `create_subs()` using the same directory tree. 

### Filling 

The directory is filled using a series of subdirectory-specific functions that are combined in the overall `fill_dir()` function. 

`fill_raw` downloads each of the raw data sets 