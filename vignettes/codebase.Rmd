---
title: "portalcasting Codebase"
output: rmarkdown::html_vignette
author: "Juniper L. Simonis"
date: "`r format(Sys.time(), '%d %B, %Y')`"
vignette: >
  %\VignetteIndexEntry{codebase}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r, include=FALSE}
library(portalcasting)
vers <- packageVersion("portalcasting")
today <- Sys.Date()
```

This vignette outlines the codebase for the **portalcasting** package (v`r vers`), which underlies the automated iterative forecasting within the [Portal Predictions production pipeline](https://github.com/weecology/portalPredictions). **portalcasting** has utilities for setting up local versions of the pipeline for developing and testing new models. 

## Installation

To install the most recent version of **portalcasting** from GitHub:

```{r, eval=FALSE}
install.packages("devtools")
devtools::install_github("weecology/portalcasting")
```

## Directory Structure

The package uses a directory tree with two levels to organize the project:

* `main`: project folder encompassing all subfolders
* `subs`: specific subfolders that organize the project files
 
structured as

```
main
│
└──predictions
│   <previous and current predictions>
└──models
│   <model scripts>
└──data
│   <data used for a specific run of models>
└──raw
│   <stable version of raw components used to populate other folders>
└──tmp
│   <temporary files>
```

(**Note**: Previous versions of **portalcasting** had an explicitly named `base` level more basal than `main`, but that has been removed as of v0.9.0. To group the project subfolders into a multi-leveled folder, simply add structure to the `main` input, such as `main = "~/project_folder"`.)

## Instantiating a Directory

Setting up a fully functional directory for a production or sandbox pipeline consists of two steps: creating (instantiating folders that are missing) and filling (adding files to the folders). These steps can be executed separately or in combination via a general `setup_dir()` function. These functions are general and flexible, allowing for customization through a variety of arguments. 

### Creating 

The directory is established using `create_dir()`, which takes `main` and `subs` as arguments and in sequence creates each of the levels' folders if they do not already exist. This occurs through calls to `create_main()` and `create_subs()`. A typical user is likely to want to change the `main` input (to locate the forecasting directory where they would like it), but general users should not need to alter the input to `subs`.

### Filling 

The directory is filled (loaded with files for default forecasting) using a series of subdirectory-specific functions that are combined in the overall `fill_dir()` function:

* `fill_raw()` downloads each of the raw components for the directory, such as the source data and previous forecasts.
* `fill_predictions()` moves the existing predictions files from the `raw` subdirectory to the `predictions` subdirectory.
* `fill_data()` prepares the forecasting data files from the raw downloaded data files and moves them into the `data` subdirectory.
  * moons data
  * rodents data
  * covariates data 
  * metadata
* `fill_models()` writes the model scripts into the `models` subdirectory.

