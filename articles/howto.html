<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Set Up and Use a Portal Predictions Directory • portalcasting</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Set Up and Use a Portal Predictions Directory">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">portalcasting</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/adding_a_model.html">Adding a Model</a>
    </li>
    <li>
      <a href="../articles/codebase.html">portalcasting Codebase</a>
    </li>
    <li>
      <a href="../articles/howto.html">Set Up and Use a Portal Predictions Directory</a>
    </li>
    <li>
      <a href="../articles/models.html">Current Models</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/weecology/portalcasting">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Set Up and Use a Portal Predictions Directory</h1>
                        <h4 class="author">Juniper L. Simonis</h4>
            
            <h4 class="date">19 March, 2019</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/weecology/portalcasting/blob/master/vignettes/howto.Rmd"><code>vignettes/howto.Rmd</code></a></small>
      <div class="hidden name"><code>howto.Rmd</code></div>

    </div>

    
    
<p>This vignette shows how to set up and run your own <a href="https://github.com/weecology/portalPredictions">Portal Predictions</a> directory.</p>
<div id="create-a-portal-predictions-directory" class="section level3">
<h3 class="hasAnchor">
<a href="#create-a-portal-predictions-directory" class="anchor"></a>Create a Portal Predictions directory</h3>
<p>The <code><a href="../reference/setup_dir.html">setup_dir()</a></code> function creates and populates a standard Portal Predictions directory within the present location (by default) that includes <code>data</code>, <code>models</code>, <code>PortalData</code>, <code>predictions</code> and <code>tmp</code> subdirectories. By default, <code><a href="../reference/setup_dir.html">setup_dir()</a></code> downloads the most up-to-date version of the <a href="https://zenodo.org/record/2541170">Portal Data from Zenodo</a> into the <code>PortalData</code> subdirectory, prepares the moons, rodents, covariates, and metadata data files (and places them in the <code>data</code> subdirectory), copies the historic covariate forecast data file available in the package (<code>/inst/extdata/covariate_forecasts.csv</code>) into the <code>data</code> subdirectory, downloads the most recent set of model forecasts into the <code>predictions</code> subdirectory and populates the <code>models</code> subdirectory with scripts for the four existing models (“AutoArima”, “ESSS”, “nbGARCH”, and “pevGARCH”).</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="../reference/setup_dir.html">setup_dir</a></span>()</a></code></pre></div>
</div>
<div id="run-a--cast-forecast-or-hindcast" class="section level3">
<h3 class="hasAnchor">
<a href="#run-a--cast-forecast-or-hindcast" class="anchor"></a>Run a “-cast” (forecast or hindcast)</h3>
<p>The <code><a href="../reference/portalcast.html">portalcast()</a></code> function controls the running of potentially multiple models for either a forecast or a hindcast. It will prepare the data (rodents, covariates, newmoons, metadata) as needed, verify that the requested models are available to run, run the models, compile the output, and generate an ensemble (if desired). Presently, the preloaded model set includes <a href="https://weecology.github.io/portalcasting/articles/models.html">four models</a>: ESSS, AutoArima, nbGARCH, and pevGARCH.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="../reference/portalcast.html">portalcast</a></span>()</a></code></pre></div>
</div>
<div id="tidy-up-the-temporary-files" class="section level3">
<h3 class="hasAnchor">
<a href="#tidy-up-the-temporary-files" class="anchor"></a>Tidy up the temporary files</h3>
<p>The <code><a href="../reference/cleanup_dir.html">cleanup_dir()</a></code> function simply removes the temporary files and folders from the directory.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="../reference/cleanup_dir.html">cleanup_dir</a></span>()</a></code></pre></div>
</div>
<div id="options" class="section level3">
<h3 class="hasAnchor">
<a href="#options" class="anchor"></a>Options</h3>
<p>All required inputs to <code><a href="../reference/setup_dir.html">setup_dir()</a></code>, <code><a href="../reference/portalcast.html">portalcast()</a></code>, and <code><a href="../reference/cleanup_dir.html">cleanup_dir()</a></code> are encompassed within the singular argument <code>options_all</code>, which is a hierarchical list of control arguments, defined through the options-setting function <code><a href="../reference/all_options.html">all_options()</a></code> and the default values are appropriate for basic forecast usage. There are many options available for the user to control and a full list can be found by running <code><a href="../reference/all_options.html">?all_options</a></code>, to return the help file for the functions that generate the hierarchical options list.</p>
</div>
<div id="loading-the-model-output-into-an-r-session" class="section level3">
<h3 class="hasAnchor">
<a href="#loading-the-model-output-into-an-r-session" class="anchor"></a>Loading the model output into an R session</h3>
<p>Once the models have finished running, you can read the results back into R using <code><a href="../reference/read_cast.html">read_cast()</a></code>, which loads the most recent model forecast or hindcast, or <code><a href="../reference/read_cast.html">read_casts()</a></code>, which loads all forecasts or hindcasts:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">cast &lt;-<span class="st"> </span><span class="kw"><a href="../reference/read_cast.html">read_cast</a></span>()</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">casts &lt;-<span class="st"> </span><span class="kw"><a href="../reference/read_cast.html">read_casts</a></span>()</a></code></pre></div>
<p>Both functions have simple controls for forecasts or hindcasts and which files to load based on their date.</p>
</div>
<div id="selecting-a-subset-of-model-output" class="section level3">
<h3 class="hasAnchor">
<a href="#selecting-a-subset-of-model-output" class="anchor"></a>Selecting a subset of model output</h3>
<p>The model output that has been loaded can be subset using <code><a href="../reference/select_casts.html">select_casts()</a></code>, which has arguments to allow filtering based on <code>species</code>, <code>level</code>, <code>model</code>, and <code>newmoonnumber</code>, with the default being to return all values:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">cast_set &lt;-<span class="st"> </span><span class="kw"><a href="../reference/select_casts.html">select_casts</a></span>(casts, <span class="dt">species =</span> <span class="st">"total"</span>, <span class="dt">model =</span> <span class="st">"Ensemble"</span>, <span class="dt">level =</span> <span class="st">"All"</span>)</a></code></pre></div>
</div>
<div id="visualizing-the-model-output" class="section level3">
<h3 class="hasAnchor">
<a href="#visualizing-the-model-output" class="anchor"></a>Visualizing the model output</h3>
<p>Basic plotting of a single-species forecast can be executed using <code><a href="../reference/plot_cast_ts.html">plot_cast_ts()</a></code>, which defaults to plotting the total abundance for the control plots under the ensemble model, but has arguments to allow full flexibility.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="../reference/plot_cast_ts.html">plot_cast_ts</a></span>()</a></code></pre></div>
<div class="figure">
<img src="imgs/plot1.png" alt="Time series plot of the total rodents forecast on the control plots" width="600"><p class="caption">Time series plot of the total rodents forecast on the control plots</p>
</div>
<p><br></p>
<p>Similarly, the point-in-time forecasts for multiple species can be compared using <code>plot_cast_point</code>, which defaults to all species and the total abundance one step ahead for the control plots under the ensemble model, but has arguments to allow full flexibility.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="../reference/plot_cast_point.html">plot_cast_point</a></span>()</a></code></pre></div>
<div class="figure">
<img src="imgs/plot2.png" alt="Point-in-time forecast (mean with 90% CI) for all species and total rodents on the control plots" width="600"><p class="caption">Point-in-time forecast (mean with 90% CI) for all species and total rodents on the control plots</p>
</div>
<p><br></p>
<p>It is possible to compare the point-in-time forecasts with observed data by setting <code>with_census = TRUE</code>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw"><a href="../reference/plot_cast_point.html">plot_cast_point</a></span>(<span class="dt">with_census =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div class="figure">
<img src="imgs/plot3.png" alt="Point-in-time forecast (mean with 90% CI) with observed value (blue) for all species and total rodents on the control plots" width="600"><p class="caption">Point-in-time forecast (mean with 90% CI) with observed value (blue) for all species and total rodents on the control plots</p>
</div>
</div>
<div id="visualizing-model-evaluation" class="section level3">
<h3 class="hasAnchor">
<a href="#visualizing-model-evaluation" class="anchor"></a>Visualizing model evaluation</h3>
<p>The models are evaluated using a variety of error metrics, which can be plotted using <code><a href="../reference/plot_err_lead_spp_mods.html">plot_err_lead_spp_mods()</a></code> and <code><a href="../reference/plot_cov_RMSE_mod_spp.html">plot_cov_RMSE_mod_spp()</a></code>.</p>
<p><code><a href="../reference/plot_err_lead_spp_mods.html">plot_err_lead_spp_mods()</a></code> shows the raw forecast error as a function of lead time across the combination of species and models:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="../reference/plot_err_lead_spp_mods.html">plot_err_lead_spp_mods</a></span>()</a></code></pre></div>
<div class="figure">
<img src="imgs/plot4.png" alt="Forecast error as a function of lead time for six representative species and total rodents (rows) using four models and the ensemble (columns) produced on three forecast dates (lines)" width="600"><p class="caption">Forecast error as a function of lead time for six representative species and total rodents (rows) using four models and the ensemble (columns) produced on three forecast dates (lines)</p>
</div>
<p><br></p>
<p>The arguments are set up by default to plot a set of recent forecasts for a set of common species in the control plots, but they allow for flexibility.</p>
<p><br></p>
<p>Similarly, <code><a href="../reference/plot_cov_RMSE_mod_spp.html">plot_cov_RMSE_mod_spp()</a></code> displays the coverage and root mean squared error (RMSE) of each model across species:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw"><a href="../reference/plot_cov_RMSE_mod_spp.html">plot_cov_RMSE_mod_spp</a></span>()</a></code></pre></div>
<div class="figure">
<img src="imgs/plot5.png" alt="Coverage (left column) and root mean squared error (RMSE, right column) for six representative species and total rodents (rows) using four models and the ensemble (x-axis) produced on all available hindcasts (lines)" width="600"><p class="caption">Coverage (left column) and root mean squared error (RMSE, right column) for six representative species and total rodents (rows) using four models and the ensemble (x-axis) produced on all available hindcasts (lines)</p>
</div>
<p><br></p>
<p>By default, the function produces a figure using all available hindcasts for a set of common species in the control plots, but the arguments allow for flexibility. ### Reading in data to the R console from the directory</p>
<p>A series of <code>read_&lt;name&gt;</code> functions are available for simple loading of the data sets into R from the directory. A generalized <code>read_data</code> function includes an argument for which data set to load (“all”, “controls”, “covariates”, “moons”, or “metadata”), and each of those data sets also has a specific function, such as <code>read_all</code>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw"><a href="../reference/read_data.html">read_data</a></span>(<span class="dt">data_name =</span> <span class="st">"all"</span>)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="kw"><a href="../reference/read_data.html">read_data</a></span>(<span class="dt">data_name =</span> <span class="st">"controls"</span>)</a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="kw"><a href="../reference/read_data.html">read_data</a></span>(<span class="dt">data_name =</span> <span class="st">"covariates"</span>)</a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="kw"><a href="../reference/read_data.html">read_data</a></span>(<span class="dt">data_name =</span> <span class="st">"moons"</span>)</a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="kw"><a href="../reference/read_data.html">read_data</a></span>(<span class="dt">data_name =</span> <span class="st">"metadata"</span>)</a>
<a class="sourceLine" id="cb11-6" data-line-number="6"></a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="kw"><a href="../reference/read_data.html">read_all</a></span>()</a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="kw"><a href="../reference/read_data.html">read_controls</a></span>()</a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="kw"><a href="../reference/read_data.html">read_covariates</a></span>()</a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="kw"><a href="../reference/read_data.html">read_moons</a></span>()</a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="kw"><a href="../reference/read_data.html">read_metadata</a></span>()</a></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Juniper L. Simonis, Glenda M. Yenni, Ellen K. Bledsoe, Erica M. Christensen, Shawn D. Taylor, Hao Ye, Ethan P. White, S.K. Morgan Ernest.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
